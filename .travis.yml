# Build all valid Ubuntu/ROS combinations available on Travis VMs.
language: generic
sudo: required
dist: bionic
compiler:
  - gcc

before_install:
  - sudo sh -c 'echo "deb http://packages.ros.org/ros/ubuntu $(lsb_release -sc) main" > /etc/apt/sources.list.d/ros-latest.list'
  - sudo apt-key adv --keyserver 'hkp://keyserver.ubuntu.com:80' --recv-key C1CF6E31E6BADE8868B172B4F42ED6FBAB17C654
  - sudo apt-get update -qq
  - sudo apt-get install dpkg
  - sudo apt-get update -qq
  - ./installation/scripts/install_dependencies.sh      
  - git clean -fd
  - git reset --hard
  - git submodule deinit -f .
  - git submodule sync
  - git submodule update --init --recursive
  - gitman install --force

install:
  - mkdir -p ~/catkin_ws/src  
  - cd ~/catkin_ws/src 
  - ln -s $CI_SOURCE_PATH .
  - source /opt/ros/melodic/setup.bash
  - rosdep update
  - catkin init
  - catkin config --profile debug --cmake-args -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DCMAKE_CXX_FLAGS='-std=c++17 -march=native -fno-diagnostics-color' -DCMAKE_C_FLAGS='-march=native -fno-diagnostics-color'
  - catkin profile set debug

before_script:
script:
  - catkin build 
